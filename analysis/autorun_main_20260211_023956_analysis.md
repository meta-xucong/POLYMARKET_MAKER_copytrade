# autorun_main_20260211_023956 日志分析

## 结论（为什么最后只剩 2 个子进程）

1. 进程数并不是“没拉起来”，而是**先拉到了 15~18 个，再持续回落**。
   - 例如日志中出现了 `[RUN 18]`，说明高峰期并发正常。
2. 回落的主因是大量话题因 `SIGNAL_TIMEOUT` 退出后，回填机制达到重试上限。
   - 回填日志先出现 `重试=1/3`、`2/3`，后续大量变成 `3/3`。
   - 最后稳定在 `无可回填token，记录=98 运行=2 pending=0`，说明可用候选已耗尽，调度器没有可补位的话题。
3. 同期 WS 数据质量变差（bid 连续 None、频繁重连）加速了“无信号超时”退出，形成负反馈。

## 关键证据

- 初期并发可拉起：`[RUN 18]`（并发能力本身存在）。
- 中后期持续下降：
  - `运行=11 -> 9 -> 8 -> 6 -> 5 -> 4 -> 3 -> 2` 的连续记录。
  - 尾部反复出现 `无可回填token，记录=98 运行=2 pending=0`。
- 回填耗尽：
  - 多个 token 出现 `重试=3/3`（如 109485..., 952954..., 279116..., 492017... 等）。
- WS 异常侧证：
  - `WebSocket bid 返回 None（连续 4/5/6/8/9 次），触发降级：回退 REST API`。
  - `连接次数` 从 12 增长到 18，且已订阅 token 数一度降到 2。

## 其他错误/可优化点

1. **退出原因过于集中在 SIGNAL_TIMEOUT，且无持仓场景反复触发**
   - 当前策略在低活跃市场会不断“启动->等待->超时->退出->回填重试”，最终耗尽重试配额。
   - 建议：将无持仓+低成交话题转为低频守护状态，而不是计入强制超时退出。

2. **回填重试策略建议增加“冷却+按市场活跃度恢复”**
   - 现在 3 次用完即长期不可回填，导致全局并发衰减不可逆。
   - 建议：引入时间窗重置（如 6h/24h）或基于最近成交/盘口更新恢复资格。

3. **WS 健康度不足时应触发“系统级保护”，而非只在子进程内降级**
   - 目前是子进程看到 bid None 后回退 REST，但调度层仍按正常节奏运行。
   - 建议：当全局 WS 健康度下降（高 None 比例 + 高频重连）时：
     - 暂停新开话题；
     - 提高 signal timeout 阈值；
     - 对已运行策略降频，避免误判“无信号”。

4. **自动结束市场识别能力已生效，但覆盖不足**
   - 日志只看到 1 条 `市场已结束，自动结束该话题`，而后续大多数退出仍归因 `SIGNAL_TIMEOUT`。
   - 建议：把“市场已结束/临近结算/成交冻结”前置识别，减少无效重试消耗。

5. **可观测性建议**
   - 增加按原因维度的退出计数（SIGNAL_TIMEOUT / MARKET_CLOSED / NO_POSITION / WS_DEGRADED）。
   - 增加“可回填池大小”和“重试耗尽 token 数”的周期指标，便于提前发现并发衰减。

