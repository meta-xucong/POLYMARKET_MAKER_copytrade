# autorun_main_20260205_175040.log 深入取证分析（按你的4个问题）

> 数据来源：仅基于 `autorun_main_20260205_175040.log` 主日志。由于仓库内无子进程明细日志（`autorun_*.log`），结论来自主日志中的 RUN 快照与聚合器/健康检查记录。

## 0) 分析方法（简述）
- 解析 RUN 汇总行中的 `topic` 与 `last_line`，做按 token 的时间序列追踪。
- 解析 `[HEALTH]` 下方 token 前缀（20位）与 `[CLEANUP] ... 60分钟无更新` 事件做关联。
- 对于“是否恢复正常”，采用“问题事件后出现正常事件”判定：
  - 正常事件示例：`[MAKER][BUY/SELL] 挂单状态`、`[DIAG][BID/ASK] ✓ 已刷新快照`、`[WS][SHARED] seq=...`。

---

## 1) HEALTH 超30分钟未更新 token：最终60分钟踢出 vs 后续恢复

### 统计结果（基于主日志可观测集合）
- 在 `[HEALTH]` 明细中一共观察到 **58 个唯一 token 前缀**。
- 这 58 个前缀后续都出现了 `60分钟无更新` 的 CLEANUP 记录（即被清理）。
- 进一步看“从首次 HEALTH 到首次 CLEANUP 的区间内，是否出现恢复正常迹象”：
  - **2 个** token 前缀在被清理前出现过“恢复正常”信号；
  - **55 个**未观察到恢复即被清理；
  - 其余 1 个为边界噪声（RUN last_line 为 `-` 之类非交易语义）。

### 样本证据
- HEALTH 告警样例：`[HEALTH] ... 超过30分钟未更新`。【F:autorun_main_20260205_175040.log†L1944-L1944】
- 对应 60分钟清理样例：`- 55201180171382344648...: 60分钟无更新`。【F:autorun_main_20260205_175040.log†L2281-L2282】
- “先告警后恢复（再后续可能再次变差）”样例：
  - token `54821303111843706420...` 在 HEALTH 中出现（31分钟前），后续出现 `已刷新快照` 与 `MAKER SELL 挂单状态`，说明并非“从此永久无信号”。【F:autorun_main_20260205_175040.log†L13198-L13198】【F:autorun_main_20260205_175040.log†L5274-L5274】【F:autorun_main_20260205_175040.log†L5300-L5300】

### 结论解读
- **主导情况更像“低流动性/长时间无更新导致被清理”**，不是“全部 token 一旦无信号就再也没有信号”。
- 但也确实存在少量“短暂恢复后再次沉寂并被清理”的 token，说明链路并非全局失效。

---

## 2) 缓存过期 token，后续是否能恢复更新并正常运行？

### 统计结果
- 观察到出现“缓存过期”告警的 topic：**33 个**。
- 这 33 个里，后续都出现过 `✓ 已刷新快照`（即 **33/33 有恢复**）。

### 样本证据
- 过期告警样例：`[DIAG][ASK] ⚠ 缓存数据过期...`。【F:autorun_main_20260205_175040.log†L405-L405】
- 后续刷新样例：`[DIAG][BID] ✓ 已刷新快照...`。【F:autorun_main_20260205_175040.log†L1927-L1927】
- 另一样例：早期过期后，后续也出现刷新成功记录。【F:autorun_main_20260205_175040.log†L449-L449】【F:autorun_main_20260205_175040.log†L206-L206】

### 结论解读
- 这个维度支持你的判断：**多数属于数据延迟/抖动后的自恢复，不是程序必然性故障**。

---

## 3) `WebSocket bid 返回 None` 后，是否有后续恢复？

### 统计结果
- 观察到出现过 `WebSocket bid 返回 None` 的 topic：**16 个**。
- 其中后续出现“正常事件”的：**15 个**（约 93.75%）。
- 有 1 个在日志尾段仍停留在 None（可能只是采样截止时尚未恢复）。

### 样本证据
- None 告警样例：`[DIAG][WS] WebSocket bid 返回 None...`。【F:autorun_main_20260205_175040.log†L842-L842】
- 同一类 token 后续可见恢复型事件（如 `✓ 已刷新快照` / `MAKER 状态` / `WS seq`）。【F:autorun_main_20260205_175040.log†L864-L864】【F:autorun_main_20260205_175040.log†L2316-L2316】
- 尾段仍是 None 的样例（边界样本）：【F:autorun_main_20260205_175040.log†L50064-L50064】

### 结论解读
- 大部分 None 是**可恢复的阶段性缺失**，不支持“只要没信号就从头到尾没信号”的强假设。

---

## 4) 激进卖出逻辑是否有“正常生效”记录？

### 观察
- 主日志明确出现了激进卖出动作：
  - `[MAKER][SELL][激进] 触及地板价，保持地板挂单`

### 证据
- 该事件在 RUN 快照中可见，说明该分支曾实际执行。【F:autorun_main_20260205_175040.log†L5523-L5523】
- 代码中对应逻辑为“触底锁价/超时降价/卖一下行时重挂”等机制，日志语义一致。【F:POLYMARKET_MAKER_copytrade_v2/POLYMARKET_MAKER_AUTO/POLYMARKET_MAKER/maker_execution.py†L1870-L1891】【F:POLYMARKET_MAKER_copytrade_v2/POLYMARKET_MAKER_AUTO/POLYMARKET_MAKER/maker_execution.py†L1915-L1931】

### 结论解读
- 至少“触及地板价并保持地板挂单”这一激进分支已经被触发，**逻辑可达且在运行**。
- 本主日志中未看到更多“超时下调挂价”文案，不代表逻辑失效，只能说明该日触发样本较少。

---

## 总结（针对你的核心判断）
- （1）HEALTH 告警对象在可观测样本里大多最终被 60 分钟规则清理，说明低流动性/长时间无更新是主要矛盾；但存在少量“先恢复后再沉寂”的反例，不能下“程序全局取数异常”的结论。
- （2）缓存过期后恢复比例很高（本日志样本 33/33）。
- （3）WS bid None 后大多数可恢复（15/16）。
- （4）激进卖出逻辑有实证触发，至少地板锁价分支正常生效。
